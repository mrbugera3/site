<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8">
<title>Mini Galaga</title>
<style>
body{
  margin:0;
  background:black;
  color:white;
  font-family:Arial;
  text-align:center;
}
canvas{
  display:block;
  margin:auto;
  background:black;
}
#ui{
  position:fixed;
  top:10px;
  left:10px;
  font-size:18px;
}
#gameover{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  display:none;
}
button{
  padding:10px 20px;
  font-size:16px;
}
</style>
</head>
<body>

<div id="ui">Score: <span id="score">0</span></div>

<div id="gameover">
  <h1>Game Over</h1>
  <button onclick="restart()">Restart</button>
</div>

<canvas id="c" width="400" height="600"></canvas>

<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");
const scoreEl = document.getElementById("score");
const gameoverEl = document.getElementById("gameover");

let player, bullets, enemies, score, gameOver, keys;

function init(){
  player = {x:180, y:540, w:40, h:20};
  bullets = [];
  enemies = [];
  score = 0;
  gameOver = false;
  keys = {};
  scoreEl.textContent = score;
  gameoverEl.style.display = "none";

  spawnEnemies();
}

function spawnEnemies(){
  enemies = [];
  for(let r=0; r<3; r++){
    for(let i=0; i<8; i++){
      enemies.push({x:40+i*40, y:40+r*40, w:30, h:20, dx:1});
    }
  }
}

document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

// mouse control
document.addEventListener("mousemove",e=>{
  const rect = c.getBoundingClientRect();
  player.x = e.clientX - rect.left - player.w/2;
});

// touch control
c.addEventListener("touchmove", e=>{
  e.preventDefault();
  const rect = c.getBoundingClientRect();
  const t = e.touches[0];
  player.x = t.clientX - rect.left - player.w/2;
},{passive:false});

setInterval(()=>{
  if(!gameOver){
    bullets.push({x:player.x+18, y:player.y});
  }
},400);

function loop(){
  ctx.clearRect(0,0,400,600);

  if(gameOver) return;

  // player movement
  if(keys["ArrowLeft"]) player.x -= 4;
  if(keys["ArrowRight"]) player.x += 4;
  player.x = Math.max(0, Math.min(360, player.x));

  // draw player
  ctx.fillStyle = "lime";
  ctx.fillRect(player.x, player.y, player.w, player.h);

  // bullets
  bullets.forEach(b=>b.y -= 6);
  bullets = bullets.filter(b=>b.y > -10);
  ctx.fillStyle = "white";
  bullets.forEach(b=>ctx.fillRect(b.x, b.y, 4, 10));

  // enemies movement
  let edge = false;
  enemies.forEach(e=>{
    e.x += e.dx;
    if(e.x < 0 || e.x > 370) edge = true;
    if(e.y + e.h > player.y){
      gameOver = true;
      gameoverEl.style.display = "block";
    }
  });

  if(edge){
    enemies.forEach(e=>{
      e.dx *= -1;
      e.y += 10;
    });
  }

  // draw enemies
  ctx.fillStyle = "red";
  enemies.forEach(e=>ctx.fillRect(e.x, e.y, e.w, e.h));

  // collisions
  bullets.forEach(b=>{
    enemies.forEach(e=>{
      if(b.x<e.x+e.w && b.x+4>e.x &&
         b.y<e.y+e.h && b.y+10>e.y){
        e.dead = true;
        b.dead = true;
        score += 10;
        scoreEl.textContent = score;
      }
    });
  });

  bullets = bullets.filter(b=>!b.dead);
  enemies = enemies.filter(e=>!e.dead);

  if(enemies.length === 0) spawnEnemies();

  requestAnimationFrame(loop);
}

function restart(){
  init();
  loop();
}

init();
loop();
</script>

</body>
</html>
